<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulir Penerimaan dan Penginstalan IFP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-full">
    <div class="container mx-auto px-4 py-8">
        <div class="max-w-2xl mx-auto bg-white rounded-xl shadow-lg p-8">
            <!-- Header with Logo -->
            <div class="text-center mb-8">
                <img src="https://i.imgur.com/y5VImI4.png" alt="Logo IFP" class="mx-auto mb-6 h-24 w-auto" onerror="this.style.display='none';">
                <h1 class="text-3xl font-bold text-gray-800">Formulir Penerimaan dan Penginstalan IFP</h1>
            </div>
            
            <form id="schoolForm" class="space-y-6">
                <!-- Kabupaten/Kota -->
                <div>
                    <label for="kabupaten" class="block text-sm font-medium text-gray-700 mb-2">
                        Kabupaten/Kota <span class="text-red-500">*</span>
                    </label>
                    <select id="kabupaten" name="kabupaten" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white" required>
                        <option value="">Pilih Kabupaten/Kota...</option>
                    </select>
                    <div id="kabupatenLoading" class="hidden mt-2">
                        <div class="loading"></div>
                        <span class="ml-2 text-sm text-gray-600">Memuat data...</span>
                    </div>
                </div>

                <!-- Jenjang -->
                <div>
                    <label for="jenjang" class="block text-sm font-medium text-gray-700 mb-2">
                        Jenjang <span class="text-red-500">*</span>
                    </label>
                    <select id="jenjang" name="jenjang" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white" required disabled>
                        <option value="">Pilih jenjang terlebih dahulu kabupaten/kota...</option>
                    </select>
                    <div id="jenjangLoading" class="hidden mt-2">
                        <div class="loading"></div>
                        <span class="ml-2 text-sm text-gray-600">Memuat jenjang...</span>
                    </div>
                </div>

                <!-- NPSN -->
                <div>
                    <label for="npsn" class="block text-sm font-medium text-gray-700 mb-2">
                        NPSN <span class="text-red-500">*</span>
                    </label>
                    <select id="npsn" name="npsn" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white" required disabled>
                        <option value="">Pilih NPSN terlebih dahulu jenjang...</option>
                    </select>
                    <div id="npsnLoading" class="hidden mt-2">
                        <div class="loading"></div>
                        <span class="ml-2 text-sm text-gray-600">Memuat NPSN...</span>
                    </div>
                </div>

                <!-- Nama Satuan Pendidikan (Auto-filled) -->
                <div>
                    <label for="namaSatpen" class="block text-sm font-medium text-gray-700 mb-2">
                        Nama Satuan Pendidikan
                    </label>
                    <input type="text" id="namaSatpen" name="namaSatpen" class="w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-50 text-gray-700" readonly placeholder="Akan terisi otomatis setelah memilih NPSN">
                </div>

                <!-- Status Penerimaan -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-3">
                        Status Penerimaan <span class="text-red-500">*</span>
                    </label>
                    <div class="flex items-center space-x-6">
                        <label class="flex items-center">
                            <input type="radio" name="statusPenerimaan" value="sudah-menerima" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500 focus:ring-2" required>
                            <span class="ml-2 text-sm text-gray-700">✅ Sudah Menerima</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="statusPenerimaan" value="belum-menerima" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500 focus:ring-2" required>
                            <span class="ml-2 text-sm text-gray-700">⏳ Belum Menerima</span>
                        </label>
                    </div>
                </div>

                <!-- Tanggal Penerimaan -->
                <div id="tanggalPenerimaanDiv">
                    <label for="tanggalPenerimaan" class="block text-sm font-medium text-gray-700 mb-2">
                        Tanggal Penerimaan <span class="text-red-500">*</span>
                    </label>
                    <input type="date" id="tanggalPenerimaan" name="tanggalPenerimaan" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-gray-100" required disabled>
                </div>

                <!-- Status Penginstalan -->
                <div id="statusPenginstalanDiv" class="hidden">
                    <label class="block text-sm font-medium text-gray-700 mb-3">
                        Status Penginstalan <span class="text-red-500">*</span>
                    </label>
                    <div class="flex items-center space-x-6">
                        <label class="flex items-center">
                            <input type="radio" name="statusPenginstalan" value="sudah-install" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500 focus:ring-2">
                            <span class="ml-2 text-sm text-gray-700">✅ Sudah Install</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="statusPenginstalan" value="belum-install" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500 focus:ring-2">
                            <span class="ml-2 text-sm text-gray-700">⏳ Belum Install</span>
                        </label>
                    </div>
                </div>

                <!-- Tanggal Penginstalan -->
                <div id="tanggalPenginstalanDiv" class="hidden">
                    <label for="tanggalPenginstalan" class="block text-sm font-medium text-gray-700 mb-2">
                        Tanggal Penginstalan <span class="text-red-500">*</span>
                    </label>
                    <input type="date" id="tanggalPenginstalan" name="tanggalPenginstalan" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-gray-100" disabled>
                </div>

                <!-- Ketersediaan Listrik -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-3">
                        Ketersediaan Listrik <span class="text-red-500">*</span>
                    </label>
                    <div class="flex items-center space-x-6">
                        <label class="flex items-center">
                            <input type="radio" name="ketersediaanListrik" value="tersedia" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500 focus:ring-2" required>
                            <span class="ml-2 text-sm text-gray-700">✅ Tersedia</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="ketersediaanListrik" value="tidak-tersedia" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500 focus:ring-2" required>
                            <span class="ml-2 text-sm text-gray-700">❌ Tidak Tersedia</span>
                        </label>
                    </div>
                </div>

                <!-- Keterangan Listrik -->
                <div>
                    <label for="keteranganListrik" class="block text-sm font-medium text-gray-700 mb-2">
                        Keterangan Listrik
                    </label>
                    <textarea id="keteranganListrik" name="keteranganListrik" rows="3" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white resize-none" placeholder="Masukkan keterangan tambahan mengenai ketersediaan listrik (opsional)"></textarea>
                </div>

                <!-- Ketersediaan Internet -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-3">
                        Ketersediaan Internet <span class="text-red-500">*</span>
                    </label>
                    <div class="flex items-center space-x-6">
                        <label class="flex items-center">
                            <input type="radio" name="ketersediaanInternet" value="tersedia" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500 focus:ring-2" required>
                            <span class="ml-2 text-sm text-gray-700">✅ Tersedia</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="ketersediaanInternet" value="tidak-tersedia" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500 focus:ring-2" required>
                            <span class="ml-2 text-sm text-gray-700">❌ Tidak Tersedia</span>
                        </label>
                    </div>
                </div>

                <!-- Keterangan Internet -->
                <div>
                    <label for="keteranganInternet" class="block text-sm font-medium text-gray-700 mb-2">
                        Keterangan Internet
                    </label>
                    <textarea id="keteranganInternet" name="keteranganInternet" rows="3" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white resize-none" placeholder="Masukkan keterangan tambahan mengenai ketersediaan internet (opsional)"></textarea>
                </div>

                <!-- Submit Button -->
                <div class="pt-4">
                    <button type="submit" id="submitBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition duration-200 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed">
                        <span id="submitText">Submit Data</span>
                        <div id="submitLoading" class="hidden inline-block ml-2">
                            <div class="loading"></div>
                        </div>
                    </button>
                </div>
            </form>

            <!-- Result Display -->
            <div id="result" class="hidden mt-8 p-6 bg-green-50 border border-green-200 rounded-lg">
                <h3 class="text-lg font-semibold text-green-800 mb-4">Data yang Dipilih:</h3>
                <div id="resultContent" class="space-y-2 text-sm text-green-700"></div>
            </div>
        </div>
    </div>

    <script>
        let schoolData = [];
        
        // Convert Google Sheets URL to CSV format
        const SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vR-5DI1rYTsqo50b8unUKAzJ6U7ryQfRfXMlSzH8paDKHsVhcSqPmL1KtvJvTaved0-LmdF5R3K_vaD/pub?output=csv';
        
        // Load data from Google Sheets
        async function loadData() {
            try {
                document.getElementById('kabupatenLoading').classList.remove('hidden');
                
                const response = await fetch(SHEET_URL);
                const csvText = await response.text();
                
                // Parse CSV
                const rows = csvText.split('\n').map(row => {
                    // Simple CSV parsing - handles basic cases
                    const cols = [];
                    let current = '';
                    let inQuotes = false;
                    
                    for (let i = 0; i < row.length; i++) {
                        const char = row[i];
                        if (char === '"') {
                            inQuotes = !inQuotes;
                        } else if (char === ',' && !inQuotes) {
                            cols.push(current.trim());
                            current = '';
                        } else {
                            current += char;
                        }
                    }
                    cols.push(current.trim());
                    return cols;
                });
                
                // Skip header row and process data
                schoolData = rows.slice(1).filter(row => row.length >= 4 && row[0]).map(row => ({
                    kabupaten: row[0]?.replace(/"/g, '').trim(),
                    jenjang: row[1]?.replace(/"/g, '').trim(),
                    npsn: row[2]?.replace(/"/g, '').trim(),
                    nama: row[3]?.replace(/"/g, '').trim()
                }));
                
                populateKabupaten();
                document.getElementById('kabupatenLoading').classList.add('hidden');
                
            } catch (error) {
                console.error('Error loading data:', error);
                document.getElementById('kabupatenLoading').classList.add('hidden');
                alert('Gagal memuat data dari spreadsheet. Silakan coba lagi.');
            }
        }
        
        function populateKabupaten() {
            const kabupatenSelect = document.getElementById('kabupaten');
            const uniqueKabupaten = [...new Set(schoolData.map(item => item.kabupaten))].sort();
            
            kabupatenSelect.innerHTML = '<option value="">Pilih Kabupaten/Kota...</option>';
            uniqueKabupaten.forEach(kabupaten => {
                if (kabupaten) {
                    const option = document.createElement('option');
                    option.value = kabupaten;
                    option.textContent = kabupaten;
                    kabupatenSelect.appendChild(option);
                }
            });
        }
        
        function populateJenjang(selectedKabupaten) {
            const jenjangSelect = document.getElementById('jenjang');
            const npsnSelect = document.getElementById('npsn');
            const namaSatpen = document.getElementById('namaSatpen');
            
            // Reset dependent fields
            npsnSelect.innerHTML = '<option value="">Pilih NPSN terlebih dahulu jenjang...</option>';
            npsnSelect.disabled = true;
            namaSatpen.value = '';
            
            if (!selectedKabupaten) {
                jenjangSelect.innerHTML = '<option value="">Pilih jenjang terlebih dahulu kabupaten/kota...</option>';
                jenjangSelect.disabled = true;
                return;
            }
            
            document.getElementById('jenjangLoading').classList.remove('hidden');
            
            setTimeout(() => {
                const filteredData = schoolData.filter(item => item.kabupaten === selectedKabupaten);
                const uniqueJenjang = [...new Set(filteredData.map(item => item.jenjang))].sort();
                
                jenjangSelect.innerHTML = '<option value="">Pilih Jenjang...</option>';
                uniqueJenjang.forEach(jenjang => {
                    if (jenjang) {
                        const option = document.createElement('option');
                        option.value = jenjang;
                        option.textContent = jenjang;
                        jenjangSelect.appendChild(option);
                    }
                });
                
                jenjangSelect.disabled = false;
                document.getElementById('jenjangLoading').classList.add('hidden');
            }, 300);
        }
        
        function populateNPSN(selectedKabupaten, selectedJenjang) {
            const npsnSelect = document.getElementById('npsn');
            const namaSatpen = document.getElementById('namaSatpen');
            
            // Reset dependent fields
            namaSatpen.value = '';
            
            if (!selectedKabupaten || !selectedJenjang) {
                npsnSelect.innerHTML = '<option value="">Pilih NPSN terlebih dahulu jenjang...</option>';
                npsnSelect.disabled = true;
                return;
            }
            
            document.getElementById('npsnLoading').classList.remove('hidden');
            
            setTimeout(() => {
                const filteredData = schoolData.filter(item => 
                    item.kabupaten === selectedKabupaten && item.jenjang === selectedJenjang
                );
                
                npsnSelect.innerHTML = '<option value="">Pilih NPSN...</option>';
                filteredData.forEach(item => {
                    if (item.npsn) {
                        const option = document.createElement('option');
                        option.value = item.npsn;
                        option.textContent = `${item.npsn} - ${item.nama}`;
                        option.dataset.nama = item.nama;
                        npsnSelect.appendChild(option);
                    }
                });
                
                npsnSelect.disabled = false;
                document.getElementById('npsnLoading').classList.add('hidden');
            }, 300);
        }
        
        function updateNamaSatpen(selectedNPSN) {
            const namaSatpen = document.getElementById('namaSatpen');
            const npsnSelect = document.getElementById('npsn');
            
            if (selectedNPSN) {
                const selectedOption = npsnSelect.querySelector(`option[value="${selectedNPSN}"]`);
                if (selectedOption) {
                    namaSatpen.value = selectedOption.dataset.nama || '';
                }
            } else {
                namaSatpen.value = '';
            }
        }
        
        // Event listeners
        document.getElementById('kabupaten').addEventListener('change', function() {
            populateJenjang(this.value);
        });
        
        document.getElementById('jenjang').addEventListener('change', function() {
            const selectedKabupaten = document.getElementById('kabupaten').value;
            populateNPSN(selectedKabupaten, this.value);
        });
        
        document.getElementById('npsn').addEventListener('change', function() {
            updateNamaSatpen(this.value);
        });
        
        // Handle status penerimaan change
        document.querySelectorAll('input[name="statusPenerimaan"]').forEach(radio => {
            radio.addEventListener('change', function() {
                const tanggalPenerimaanInput = document.getElementById('tanggalPenerimaan');
                const statusPenginstalanDiv = document.getElementById('statusPenginstalanDiv');
                const tanggalPenginstalanDiv = document.getElementById('tanggalPenginstalanDiv');
                const tanggalPenginstalanInput = document.getElementById('tanggalPenginstalan');
                
                if (this.value === 'sudah-menerima') {
                    // Enable tanggal penerimaan
                    tanggalPenerimaanInput.disabled = false;
                    tanggalPenerimaanInput.required = true;
                    tanggalPenerimaanInput.classList.remove('bg-gray-100');
                    tanggalPenerimaanInput.classList.add('bg-white');
                    
                    // Show status penginstalan
                    statusPenginstalanDiv.classList.remove('hidden');
                    document.querySelectorAll('input[name="statusPenginstalan"]').forEach(radio => {
                        radio.required = true;
                    });
                } else {
                    // Disable tanggal penerimaan
                    tanggalPenerimaanInput.disabled = true;
                    tanggalPenerimaanInput.required = false;
                    tanggalPenerimaanInput.value = '';
                    tanggalPenerimaanInput.classList.remove('bg-white');
                    tanggalPenerimaanInput.classList.add('bg-gray-100');
                    
                    // Hide status penginstalan and tanggal penginstalan
                    statusPenginstalanDiv.classList.add('hidden');
                    tanggalPenginstalanDiv.classList.add('hidden');
                    tanggalPenginstalanInput.disabled = true;
                    tanggalPenginstalanInput.required = false;
                    tanggalPenginstalanInput.value = '';
                    
                    // Reset status penginstalan radio buttons
                    document.querySelectorAll('input[name="statusPenginstalan"]').forEach(radio => {
                        radio.checked = false;
                        radio.required = false;
                    });
                }
            });
        });
        
        // Handle status penginstalan change
        document.querySelectorAll('input[name="statusPenginstalan"]').forEach(radio => {
            radio.addEventListener('change', function() {
                const tanggalPenginstalanDiv = document.getElementById('tanggalPenginstalanDiv');
                const tanggalPenginstalanInput = document.getElementById('tanggalPenginstalan');
                
                if (this.value === 'sudah-install') {
                    // Show and enable tanggal penginstalan
                    tanggalPenginstalanDiv.classList.remove('hidden');
                    tanggalPenginstalanInput.disabled = false;
                    tanggalPenginstalanInput.required = true;
                    tanggalPenginstalanInput.classList.remove('bg-gray-100');
                    tanggalPenginstalanInput.classList.add('bg-white');
                } else {
                    // Hide and disable tanggal penginstalan
                    tanggalPenginstalanDiv.classList.add('hidden');
                    tanggalPenginstalanInput.disabled = true;
                    tanggalPenginstalanInput.required = false;
                    tanggalPenginstalanInput.value = '';
                    tanggalPenginstalanInput.classList.remove('bg-white');
                    tanggalPenginstalanInput.classList.add('bg-gray-100');
                }
            });
        });
        
        // Google Apps Script Web App URL for saving data
        const SAVE_URL = 'https://script.google.com/macros/s/AKfycbyIAg-I-VF0hPhpaDikBBnY3HOyyXa7qXSOuhCXtB6qMwDDrMaSjONxhfr2EgpGyb_k/exec';
        
        // Form submission
        document.getElementById('schoolForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const submitBtn = document.getElementById('submitBtn');
            const submitText = document.getElementById('submitText');
            const submitLoading = document.getElementById('submitLoading');
            const result = document.getElementById('result');
            const resultContent = document.getElementById('resultContent');
            
            // Show loading state
            submitBtn.disabled = true;
            submitText.textContent = 'Menyimpan...';
            submitLoading.classList.remove('hidden');
            
            try {
                // Prepare data for Google Sheets (matching column order)
                const dataToSave = {
                    kabupaten: formData.get('kabupaten'), // Column A
                    jenjang: formData.get('jenjang'), // Column B
                    npsn: formData.get('npsn'), // Column C
                    namaSatpen: formData.get('namaSatpen'), // Column D
                    keteranganTanggalPenerimaan: formData.get('statusPenerimaan') === 'sudah-menerima' ? 'Sudah Menerima' : 'Belum Menerima', // Column E
                    tanggalPenerimaan: formData.get('tanggalPenerimaan') || '', // Column F
                    keteranganTanggalPenginstalan: formData.get('statusPenginstalan') === 'sudah-install' ? 'Sudah Install' : (formData.get('statusPenginstalan') === 'belum-install' ? 'Belum Install' : ''), // Column G
                    tanggalPenginstalan: formData.get('tanggalPenginstalan') || '', // Column H
                    internet: formData.get('ketersediaanInternet') === 'tersedia' ? 'Tersedia' : 'Tidak Tersedia', // Column I
                    keteranganInternet: formData.get('keteranganInternet') || '', // Column J
                    listrik: formData.get('ketersediaanListrik') === 'tersedia' ? 'Tersedia' : 'Tidak Tersedia', // Column K
                    keteranganListrik: formData.get('keteranganListrik') || '' // Column L
                };
                
                // Send data to Google Apps Script
                const response = await fetch(SAVE_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(dataToSave)
                });
                
                // Since we're using no-cors mode, we can't read the response
                // We'll assume success if no error is thrown
                
                // Display success message and form data
                const ketersediaanListrik = formData.get('ketersediaanListrik') === 'tersedia' ? '✅ Tersedia' : '❌ Tidak Tersedia';
                const ketersediaanInternet = formData.get('ketersediaanInternet') === 'tersedia' ? '✅ Tersedia' : '❌ Tidak Tersedia';
                const statusPenerimaan = formData.get('statusPenerimaan') === 'sudah-menerima' ? '✅ Sudah Menerima' : '⏳ Belum Menerima';
                
                let tanggalText = '';
                if (formData.get('statusPenerimaan') === 'sudah-menerima') {
                    tanggalText = `<div><strong>Tanggal Penerimaan:</strong> ${formData.get('tanggalPenerimaan')}</div>`;
                    
                    const statusPenginstalan = formData.get('statusPenginstalan') === 'sudah-install' ? '✅ Sudah Install' : '⏳ Belum Install';
                    tanggalText += `<div><strong>Status Penginstalan:</strong> ${statusPenginstalan}</div>`;
                    
                    if (formData.get('statusPenginstalan') === 'sudah-install') {
                        tanggalText += `<div><strong>Tanggal Penginstalan:</strong> ${formData.get('tanggalPenginstalan')}</div>`;
                    }
                }
                
                let keteranganListrikText = '';
                if (formData.get('keteranganListrik')) {
                    keteranganListrikText = `<div><strong>Keterangan Listrik:</strong> ${formData.get('keteranganListrik')}</div>`;
                }
                
                let keteranganInternetText = '';
                if (formData.get('keteranganInternet')) {
                    keteranganInternetText = `<div><strong>Keterangan Internet:</strong> ${formData.get('keteranganInternet')}</div>`;
                }
                
                resultContent.innerHTML = `
                    <div class="mb-4 p-3 bg-green-100 border border-green-300 rounded-lg">
                        <p class="text-green-800 font-semibold">✅ Data berhasil disimpan ke spreadsheet!</p>
                    </div>
                    <div><strong>Kabupaten/Kota:</strong> ${formData.get('kabupaten')}</div>
                    <div><strong>Jenjang:</strong> ${formData.get('jenjang')}</div>
                    <div><strong>NPSN:</strong> ${formData.get('npsn')}</div>
                    <div><strong>Nama Satuan Pendidikan:</strong> ${formData.get('namaSatpen')}</div>
                    <div><strong>Status Penerimaan:</strong> ${statusPenerimaan}</div>
                    ${tanggalText}
                    <div><strong>Ketersediaan Listrik:</strong> ${ketersediaanListrik}</div>
                    ${keteranganListrikText}
                    <div><strong>Ketersediaan Internet:</strong> ${ketersediaanInternet}</div>
                    ${keteranganInternetText}
                `;
                
                result.classList.remove('hidden');
                result.scrollIntoView({ behavior: 'smooth' });
                
                // Reset form after successful submission
                setTimeout(() => {
                    this.reset();
                    // Reset dependent dropdowns
                    document.getElementById('jenjang').disabled = true;
                    document.getElementById('npsn').disabled = true;
                    document.getElementById('namaSatpen').value = '';
                    document.getElementById('statusPenginstalanDiv').classList.add('hidden');
                    document.getElementById('tanggalPenginstalanDiv').classList.add('hidden');
                    result.classList.add('hidden');
                }, 3000);
                
            } catch (error) {
                console.error('Error saving data:', error);
                resultContent.innerHTML = `
                    <div class="p-3 bg-red-100 border border-red-300 rounded-lg">
                        <p class="text-red-800 font-semibold">❌ Gagal menyimpan data ke spreadsheet.</p>
                        <p class="text-red-700 text-sm mt-1">Silakan coba lagi atau hubungi administrator.</p>
                    </div>
                `;
                result.classList.remove('hidden');
                result.scrollIntoView({ behavior: 'smooth' });
            } finally {
                // Reset button state
                submitBtn.disabled = false;
                submitText.textContent = 'Submit Data';
                submitLoading.classList.add('hidden');
            }
        });
        
        // Load data when page loads
        loadData();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98bd9e3765df938e',t:'MTc2MDAxMDE4Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
